<%
  # CONFIGURA√á√ÉO VISUAL (Logica separada do HTML)
  theme = case @task.difficulty
          when 'easy'
            { color: 'bg-green-500', border: 'border-green-500', icon: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png', text: 'Rank D (F√°cil)' }
          when 'medium'
            { color: 'bg-blue-500', border: 'border-blue-500', icon: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/great-ball.png', text: 'Rank B (M√©dio)' }
          when 'hard'
            { color: 'bg-purple-600', border: 'border-purple-600', icon: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/master-ball.png', text: 'Rank S (Dif√≠cil)' }
          else
            { color: 'bg-slate-500', border: 'border-slate-500', icon: '', text: 'Rank Desconhecido' }
          end
%>

<div class="min-h-screen -mt-20 flex items-center justify-center p-4">
  
  <div class="w-full max-w-3xl bg-white rounded-3xl shadow-2xl overflow-hidden border-2 border-slate-100">
    
    <div class="<%= theme[:color] %> px-8 py-10 relative overflow-hidden">
      <div class="absolute inset-0 opacity-10" style="background-image: radial-gradient(#fff 2px, transparent 2px); background-size: 20px 20px;"></div>
      
      <div class="relative z-10 flex justify-between items-start">
        <div>
          <span class="inline-block bg-black/20 text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-widest mb-2 backdrop-blur-sm">
            Arquivo da Miss√£o #<%= @task.id %>
          </span>
          <h1 class="text-4xl font-black text-white drop-shadow-md leading-tight">
            <%= @task.title %>
          </h1>
        </div>

        <div class="bg-white/20 p-2 rounded-2xl backdrop-blur-md border border-white/30 shadow-lg transform rotate-6">
          <img src="<%= theme[:icon] %>" class="w-16 h-16 rendering-pixelated drop-shadow-lg">
        </div>
      </div>
    </div>

    <div class="p-8">
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        
        <div class="bg-yellow-50 p-4 rounded-2xl border border-yellow-100 flex flex-col items-center justify-center">
          <span class="text-xs font-bold text-yellow-600 uppercase tracking-widest">Recompensa</span>
          <div class="text-2xl font-black text-yellow-500 flex items-center gap-1 mt-1">
            <span>‚ö°</span> <%= @task.score_value %> XP
          </div>
        </div>

        <div class="bg-slate-50 p-4 rounded-2xl border border-slate-100 flex flex-col items-center justify-center">
          <span class="text-xs font-bold text-slate-400 uppercase tracking-widest">Dificuldade</span>
          <div class="text-xl font-bold text-slate-700 mt-1">
            <%= theme[:text] %>
          </div>
        </div>

        <div class="<%= @task.completed? ? 'bg-green-50 border-green-100' : 'bg-red-50 border-red-100' %> p-4 rounded-2xl border flex flex-col items-center justify-center">
          <span class="text-xs font-bold <%= @task.completed? ? 'text-green-600' : 'text-red-600' %> uppercase tracking-widest">Status</span>
          <div class="text-lg font-bold <%= @task.completed? ? 'text-green-700' : 'text-red-700' %> mt-1 flex items-center gap-2">
            <% if @task.completed? %>
              ‚úÖ Completa
            <% else %>
              <span class="animate-pulse">üî¥</span> Pendente
            <% end %>
          </div>
        </div>

      </div>

      <div class="mb-10">
        <h3 class="flex items-center text-sm font-bold text-slate-400 uppercase tracking-widest mb-4 border-b border-slate-100 pb-2">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"></path></svg>
          Briefing / Detalhes
        </h3>
        <div class="text-slate-700 text-lg leading-relaxed whitespace-pre-wrap bg-slate-50 p-6 rounded-xl border border-slate-100 font-medium">
          <%= @task.description.presence || "Nenhuma descri√ß√£o fornecida pelo comando central." %>
        </div>
      </div>

      <div class="flex flex-col md:flex-row gap-4 border-t border-slate-100 pt-8">
        
        <%= link_to root_path, class: "flex-1 flex items-center justify-center gap-2 bg-slate-100 hover:bg-slate-200 text-slate-600 font-bold py-3 px-6 rounded-xl transition-colors" do %>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
          Voltar
        <% end %>

        <%= link_to edit_task_path(@task), class: "flex-1 flex items-center justify-center gap-2 bg-blue-50 hover:bg-blue-100 text-blue-600 font-bold py-3 px-6 rounded-xl border border-blue-200 transition-colors" do %>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
          Editar Dados
        <% end %>

        <% unless @task.completed? %>
          <%= button_to complete_task_path(@task), method: :patch, class: "flex-1 w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-xl shadow-lg hover:shadow-green-500/30 transition transform hover:-translate-y-1 flex items-center justify-center gap-2" do %>
            <span>üèÜ</span> Concluir Miss√£o
          <% end %>
        <% end %>

      </div>

      <div class="mt-8 text-center">
        <%= button_to task_path(@task), method: :delete, form: { data: { turbo_confirm: 'Essa a√ß√£o √© irrevers√≠vel. Abortar miss√£o?' } }, class: "text-red-400 hover:text-red-600 text-sm font-bold uppercase tracking-widest hover:underline transition-colors" do %>
          Abortar Miss√£o (Excluir)
        <% end %>
      </div>

    </div>
  </div>

  <div data-controller="pokedex" 
     data-pokedex-task-id-value="<%= @task.id %>" 
     class="fixed bottom-6 right-6 z-50 flex flex-col items-end pointer-events-none font-sans">
  
  <div data-pokedex-target="chatWindow" 
       class="hidden pointer-events-auto w-80 h-96 bg-red-600 rounded-2xl border-4 border-red-800 shadow-2xl flex-col overflow-hidden mb-4 transition-all duration-300 origin-bottom-right">
    
    <div class="bg-red-700 p-3 flex items-center gap-2 border-b-4 border-red-900 shadow-md">
      <div class="w-8 h-8 bg-blue-400 rounded-full border-2 border-white shadow-[inset_0_0_5px_rgba(0,0,0,0.5)] animate-pulse flex items-center justify-center">
        <div class="w-2 h-2 bg-white/80 rounded-full absolute top-2 right-2"></div>
      </div>
      <div class="flex gap-1">
        <div class="w-2 h-2 bg-red-900 rounded-full"></div>
        <div class="w-2 h-2 bg-yellow-400 rounded-full"></div>
      </div>
      <span class="ml-auto text-[10px] font-black text-red-900 uppercase tracking-widest bg-red-500/50 px-2 py-1 rounded">Rotom AI</span>
    </div>

    <div class="flex-1 bg-slate-900 p-3 relative overflow-hidden flex flex-col">
      <div class="absolute inset-0 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] z-0 bg-[length:100%_2px,3px_100%] pointer-events-none opacity-20"></div>
      
      <div data-pokedex-target="messages" class="relative z-10 flex-1 overflow-y-auto custom-scrollbar pr-1 space-y-2">
        <div class="flex justify-start animate-[fadeIn_0.5s]">
          <div class="max-w-[90%] rounded-lg p-3 text-xs font-mono bg-green-900/80 text-green-100 border border-green-700 shadow-sm backdrop-blur-sm">
            <span class="font-bold mr-1 text-lg align-middle">‚ö°</span> 
            Bzzzt! Rotom-Dex online! Como posso ajudar na miss√£o "<%= @task.title %>"?
          </div>
        </div>
        
        <div data-pokedex-target="loading" class="hidden text-green-500 text-xs font-mono flex items-center gap-2 mt-2">
          <svg class="animate-spin h-4 w-4 text-green-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
          Conectando ao sat√©lite...
        </div>
      </div>
    </div>

    <div class="bg-red-700 p-3 border-t-4 border-red-900">
      <form data-action="submit->pokedex#send" class="flex gap-2">
        <input data-pokedex-target="input" type="text" placeholder="Digite sua d√∫vida..." class="w-full bg-slate-800 text-green-400 font-mono text-xs p-2 rounded border-2 border-slate-600 focus:border-green-400 focus:outline-none placeholder-slate-600 shadow-inner">
        <button type="submit" class="bg-yellow-400 hover:bg-yellow-300 text-yellow-900 font-bold px-3 py-2 rounded border-b-4 border-yellow-600 active:border-b-0 active:translate-y-1 transition-all shadow-lg text-xs">
          GO
        </button>
      </form>
    </div>
  </div>

  <button data-action="click->pokedex#toggle" 
          class="pointer-events-auto group relative w-16 h-16 bg-red-600 rounded-full border-4 border-slate-800 shadow-[0_8px_0_#1e293b] active:shadow-none active:translate-y-2 transition-all flex items-center justify-center overflow-hidden hover:bg-red-500 hover:scale-105">
    
    <div class="absolute inset-0 bg-gradient-to-b from-white/20 to-transparent pointer-events-none"></div>

    <div class="relative z-10 flex flex-col items-center justify-center">
       <div class="w-10 h-6 bg-blue-300 border-2 border-slate-900 rounded-sm mb-1 shadow-inner relative overflow-hidden">
         <div class="absolute top-0 left-0 w-full h-1 bg-white/40"></div>
       </div>
       <div class="flex gap-1">
         <div class="w-3 h-1 bg-slate-900 rounded-full"></div>
         <div class="w-3 h-1 bg-slate-900 rounded-full"></div>
         <div class="w-3 h-1 bg-slate-900 rounded-full"></div>
       </div>
    </div>
    
    <span class="absolute right-20 bg-slate-900 text-white text-xs font-bold px-3 py-2 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap border border-slate-700 shadow-xl">
      Abrir Rotom-Dex AI
      <div class="absolute top-1/2 -right-1 w-2 h-2 bg-slate-900 transform rotate-45 -translate-y-1/2 border-r border-t border-slate-700"></div>
    </span>
  </button>

</div>
  
</div>