<!DOCTYPE html>
<html class="h-full bg-slate-100">
  <head>
    <title>PokeTodo - Sua Jornada</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    <script src="https://unpkg.com/heroicons@2.0.18/24/outline/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>

  <body class="h-full font-sans text-slate-800 bg-slate-50 selection:bg-red-200 selection:text-red-900">
    
    <nav class="bg-gradient-to-r from-red-700 via-red-600 to-red-500 shadow-xl sticky top-0 z-50 border-b-4 border-slate-900">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-20">
          
          <div class="flex-shrink-0 flex items-center">
            <a href="<%= root_path %>" class="flex items-center gap-3 group">
              <div class="relative w-10 h-10 bg-slate-100 rounded-full border-4 border-slate-900 overflow-hidden shadow-inner group-hover:rotate-180 transition-transform duration-700 ease-in-out">
                 <div class="absolute bottom-0 w-full h-1/2 bg-slate-100"></div>
                 <div class="absolute top-0 w-full h-1/2 bg-red-600 border-b-4 border-slate-900"></div>
                 <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-3 h-3 bg-white border-2 border-slate-900 rounded-full z-10 shadow-sm"></div>
              </div>
              <div class="flex flex-col">
                <span class="text-2xl font-black tracking-tighter text-yellow-400 drop-shadow-[2px_2px_0_rgba(0,0,0,1)] uppercase leading-none">PokeTodo</span>
                <span class="text-[0.6rem] font-bold text-red-200 tracking-widest uppercase opacity-80">Trainer Dashboard</span>
              </div>
            </a>
          </div>

          <% if user_signed_in? %>
            <div class="hidden md:flex items-center space-x-1 bg-red-800/40 p-1.5 rounded-full border border-red-400/30 backdrop-blur-sm shadow-inner">
              
              <%= link_to root_path, class: "px-6 py-2 rounded-full text-sm font-bold transition-all duration-300 flex items-center gap-2 #{current_page?(root_path) ? 'bg-white text-red-600 shadow-md transform scale-105 ring-2 ring-red-900/10' : 'text-red-100 hover:text-white hover:bg-white/10'}" do %>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path></svg>
                Missões
              <% end %>

              <%= link_to pokemons_path, class: "px-6 py-2 rounded-full text-sm font-bold transition-all duration-300 flex items-center gap-2 #{current_page?(pokemons_path) ? 'bg-white text-red-600 shadow-md transform scale-105 ring-2 ring-red-900/10' : 'text-red-100 hover:text-white hover:bg-white/10'}" do %>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
                Pokédex
              <% end %>
            </div>
          <% end %>

          <div class="flex items-center gap-4">
            <% if user_signed_in? %>
              
              <%= link_to lootbox_path, class: "group relative inline-flex items-center justify-center px-5 py-2 overflow-hidden font-bold text-slate-900 transition-all duration-300 bg-yellow-400 rounded-xl hover:bg-yellow-300 hover:scale-105 border-b-4 border-yellow-700 active:border-b-0 active:translate-y-1 shadow-lg hover:shadow-yellow-500/50" do %>
                <span class="absolute w-0 h-0 transition-all duration-500 ease-out bg-white rounded-full group-hover:w-56 group-hover:h-56 opacity-20"></span>
                <span class="relative flex items-center gap-2 drop-shadow-sm">
                  <svg class="w-5 h-5 animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>
                  LOOT BOX
                </span>
              <% end %>

              <div class="hidden lg:flex items-center gap-3 bg-slate-900/90 pl-4 pr-1.5 py-1.5 rounded-full border border-slate-700 shadow-xl backdrop-blur-md">
                <div class="flex flex-col items-end leading-none mr-1">
                  <span class="text-[0.6rem] text-slate-400 font-bold uppercase tracking-wider">Trainer Level</span>
                  <span class="text-yellow-400 font-mono font-bold text-lg drop-shadow-md">
                    <%= current_user.points %> <span class="text-xs text-yellow-600">XP</span>
                  </span>
                </div>
                
                <%= button_to destroy_user_session_path, method: :delete, class: "bg-slate-700 hover:bg-red-600 text-slate-300 hover:text-white p-2 rounded-full transition-all duration-300 group", title: "Encerrar Sessão" do %>
                  <svg class="w-4 h-4 group-hover:rotate-90 transition-transform" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M5.636 5.636a9 9 0 1012.728 0M12 3v9" />
                  </svg>
                <% end %>
              </div>

            <% else %>
              <div class="flex gap-4">
                <%= link_to "Acessar Conta", new_user_session_path, class: "text-white font-bold hover:text-yellow-300 transition my-auto text-sm uppercase tracking-wide" %>
                <%= link_to "Nova Jornada", new_user_registration_path, class: "bg-white text-red-600 px-5 py-2.5 rounded-full font-bold shadow-lg hover:bg-yellow-300 hover:text-slate-900 transition transform hover:-translate-y-1 text-sm uppercase tracking-wide" %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <% if notice %>
        <div class="mb-4 p-4 rounded-xl bg-green-50 border-2 border-green-200 text-green-800 shadow-sm flex items-center animate-[fadeIn_0.5s_ease-out]">
          <div class="bg-green-100 p-2 rounded-full mr-3">
             <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
          </div>
          <span class="font-medium"><%= notice %></span>
        </div>
      <% end %>
      
      <% if alert %>
        <div class="mb-4 p-4 rounded-xl bg-red-50 border-2 border-red-200 text-red-800 shadow-sm flex items-center animate-[fadeIn_0.5s_ease-out]">
          <div class="bg-red-100 p-2 rounded-full mr-3">
            <svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
          </div>
          <span class="font-medium"><%= alert %></span>
        </div>
      <% end %>

      <%= yield %>
    </main>

    <script type="module">
    import { Turbo } from "@hotwired/turbo-rails"

    Turbo.setConfirmMethod((message, element) => {
      let confirmBtnText = "Sim, continuar";
      let cancelBtnText = "Cancelar";
      let iconType = "warning";

      // Personalização baseada na mensagem (opcional)
      if (message.includes("excluir") || message.includes("apagar") || message.includes("libertar")) {
        confirmBtnText = "Sim, apagar!";
        iconType = "error"; // Vermelho
      }

      return new Promise((resolve, reject) => {
        Swal.fire({
          title: 'Tem certeza?',
          text: message,
          icon: iconType,
          showCancelButton: true,
          confirmButtonColor: '#d33', // Vermelho Equipe Rocket
          cancelButtonColor: '#3085d6', // Azul Ash
          confirmButtonText: confirmBtnText,
          cancelButtonText: cancelBtnText,
          background: '#fff',
          backdrop: `
            rgba(0,0,123,0.4)
            left top
            no-repeat
          `
        }).then((result) => {
          if (result.isConfirmed) {
            resolve(true);
          } else {
            resolve(false);
          }
        })
      })
    })
  </script>

  </body>
</html>